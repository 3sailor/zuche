/*! Copyright©2008-2016 zuche.com All Rights Reserved.2016-10-09 */
!function($){function cursorMove(o,n){var cursorList=$(o).find("li:not('.first')"),k=new Number;for(i=0;i<cursorList.length;i++)"current"==cursorList[i].className&&(k=i+n,cursorList[i].className="");k<0&&(k=0),k>=cursorList.length-1&&(k=cursorList.length-1),cursorList[k].className="current"}function setCaretAtEnd(field){var b=document.getElementById(field);if(b.createTextRange){var r=b.createTextRange();r.moveStart("character",b.value.length),r.collapse(),r.select()}}function position(array,value){for(var i in array)if(array[i]==value)return i}function enterVal(oWrap,elem){elem.val($(oWrap).find("li.current").text())}function showList(oElem,w,h,t,l){oElem.css({display:"block",top:h+t,left:l,width:w-2})}function hideList(oElem){oElem.css({display:"none"})}function createMailList(oWrap,sVal,suffix,aEail,nK){nK<0&&(nK=0),nK>aEail.length-1&&(nK=aEail.length-1);var mailList="<li class='first'><span>请选择邮箱类型</span></li>",State=!0;for(k=0;k<aEail.length;k++)""!=suffix&&0==aEail[k].indexOf(suffix)&&(State=!1);nK=parseInt(""!=suffix&&State&&!position(aEail,suffix)?0:nK),""!=suffix&&State&&(mailList+=0==nK?'<li class="current"><span>'+sVal+"</span>@"+suffix+"</li>":"<li><span>"+sVal+"</span>@"+suffix+"</li>"),$.isArray(aEail)&&$.each(aEail,function(i){mailList+=State&&""!=suffix?i==nK-1?'<li class="current"><span>'+sVal+"</span>@"+aEail[i]+"</li>":"<li><span>"+sVal+"</span>@"+aEail[i]+"</li>":i==nK?'<li class="current"><span>'+sVal+"</span>@"+aEail[i]+"</li>":"<li><span>"+sVal+"</span>@"+aEail[i]+"</li>"}),mailList="<ul>"+mailList+"</ul>",$(oWrap).html(mailList)}$.fn.emailMatch=function(settings){var defaultSettings={emailTip:"请输入邮箱地址",aEmail:["163.com","qq.com","gmail.com","126.com","hotmail.com","yahoo.com","yahoo.com.cn","live.com","sohu.com","sina.com"],wrapLayer:"body",className:"mailListBox",emailRemember:!0,autoCursor:!1,position:"bottom"};return settings=settings?$.extend(defaultSettings,settings):defaultSettings,this.each(function(){var elem=$(this),t=0,l=0,w=elem.outerWidth(),h=elem.outerHeight(),arrayNum=(sMail=inputVal="",0),isIndex=-1;t=elem.position().top,l=elem.position().left;var mailWrap=document.createElement("div");$(mailWrap).attr({id:elem.attr("id"),class:settings.className}),$(settings.wrapLayer).append(mailWrap),""==$.trim(elem.val())&&elem.val(settings.emailTip),elem.focus(function(){arrayNum=0,$.trim(elem.val())==settings.emailTip&&elem.val(""),""!=$.trim(elem.val())&&(inputVal=$.trim(elem.val()),isIndex=inputVal.indexOf("@"),isIndex>=0&&(sMail=inputVal.substr(isIndex+1),inputVal=inputVal.substring(0,isIndex),""!=sMail&&(arrayNum=parseInt(position(settings.aEmail,sMail)?position(settings.aEmail,sMail):0))),settings.autoCursor&&(elem.val(inputVal),$.browser.msie&&setCaretAtEnd(elem.attr("id"))),showList($(mailWrap),w,h,t,l),createMailList(mailWrap,inputVal,sMail,settings.aEmail,arrayNum))}).blur(function(){return""==elem.val()?(elem.val(settings.emailTip),hideList($(mailWrap)),!1):(enterVal(mailWrap,elem),void hideList($(mailWrap)))}),elem.keyup(function(e){var suffixArray=[],eKey=e&&(e.which||e.keyCode);switch(eKey){case 9:return;case 13:enterVal(mailWrap,elem),hideList($(mailWrap));break;case 38:showList($(mailWrap),w,h,t,l),cursorMove(mailWrap,-1);break;case 40:showList($(mailWrap),w,h,t,l),cursorMove(mailWrap,1);break;default:inputVal=$.trim(elem.val());var keyIndex=inputVal.indexOf("@"),suffix="",suffixState=!0;if(keyIndex>=0){if(suffix=inputVal.substr(keyIndex+1),inputVal=inputVal.substring(0,keyIndex),$("#t2").text("BBB"+inputVal),""!=suffix&&settings.emailRemember)for(var i=0;i<settings.aEmail.length;i++)0==settings.aEmail[i].indexOf(suffix)&&(suffixArray.push(settings.aEmail[i]),suffixState=!1);if(""!=suffix&&!settings.emailRemember)for(var i=0;i<settings.aEmail.length;i++)if(0==settings.aEmail[i].indexOf(suffix)){arrayNum=i,suffixState=!1;break}}suffixArray=suffixArray.length>0?suffixArray:settings.aEmail,""==inputVal&&""==suffix?(hideList($(mailWrap)),arrayNum=0,createMailList(mailWrap,inputVal,suffix,settings.aEmail,arrayNum)):(showList($(mailWrap),w,h,t,l),createMailList(mailWrap,inputVal,suffix,suffixArray,arrayNum))}}),$(mailWrap).find("li:not('.first')").live("mouseover",function(){$(this).addClass("hover").siblings().removeClass("hover")}),$(mailWrap).find("li:not('.first')").live("mousedown",function(){$(this).addClass("current").siblings().removeClass("current"),enterVal(mailWrap,elem),hideList($(mailWrap))}),$(mailWrap).bind("mouseout",function(){$(mailWrap).find("li:not('.first')").removeClass("hover")})})}}(jQuery);